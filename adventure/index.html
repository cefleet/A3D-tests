<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Adventure Test</title>

    <script src="/libs/babylon.2.1-beta.debug.js"></script>
    <script src="/A3D/source/A3D.js"></script>
    <script src="/A3D/source/classes/Game.js"></script>
    <script src="/A3D/source/classes/Actor.js"></script>
    <script src="/A3D/source/classes/Actor.Player.js"></script>
    <script src="/A3D/source/classes/Scene.js"></script>
    <script src="/A3D/source/classes/Camera.js"></script>
    <script src="/A3D/source/classes/Controls.js"></script>
    <script src="/A3D/source/classes/Input.js"></script>
    <script src="/A3D/source/classes/Resource.js"></script>
    <script src="/A3D/source/classes/Input.Keyboard.js"></script>
    <script src="/A3D/source/classes/Overlay.js"></script>
    <script src="/A3D/source/classes/Object2D.js"></script>
    <script src="/A3D/source/classes/Object2D.Image.js"></script>
    <script src="/A3D/source/classes/Action.js"></script>
    <script src="/A3D/source/classes/Trigger.js"></script>
    <script src="/A3D/source/classes/Trigger.Object3D.js"></script>
    <script src="/A3D/source/classes/Trigger.Object3D.Collision.js"></script>

    <script src='/A3D-Modules/Adventure/Adventure.js'></script>
    <style>
        html, body {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id='game'></div>
<script>
    var game,scene,player,skeleton,target,tSkeletons;
    function start(){
    game = new A3D.Game.Adventure({
        containerId:'game'
    });

    game.setupScene('/adventure/scenes/','chris.babylon', function(game){
      for(s in game.activeScenes){
          //game.activeScenes[s].b3Dscene.debugLayer.show();
          scene = game.activeScenes[s];
      }
    //    scene.b3Dscene.debugLayer.show();
      skeleton = scene.b3Dscene.skeletons[0];
      game.run();//TODO this may be paused
      //There is only one animation track imported. What this means is that the animation.
      //So each animation will be a % to %.

      player = scene.b3Dscene.getMeshByName('Chris');

      BABYLON.SceneLoader.ImportMesh("", "/adventure/scenes/", "gototarget.babylon", scene.b3Dscene, function (newMeshes, particleSystems, skeletons)
{
  target = newMeshes[0];
  tSkeleton = skeletons[0];
});

      window.addEventListener("click", function (evt) {
        var pick = scene.b3Dscene.pick(evt.clientX, evt.clientY);
        player.lookAt(pick.pickedPoint); //may need to take out the y

        //start
        target.position.x = pick.pickedPoint.x;
        target.position.z = pick.pickedPoint.z;
        scene.b3Dscene.beginAnimation(tSkeleton,0,100,true);
      //  console.log(pick);

        player.dir = new BABYLON.Vector3(0, 0, 1);
        //player.translate(new BABYLON.Vector3(0, 0, 1),-0.2,0);
        game.actions.move.active = true;
        scene.b3Dscene.beginAnimation(skeleton,0,30,true);
        //doSomething(pick);
     });

     game.createAction({
       name : 'move',
       id : 'move',
       active : false,
       func : function(){
         this.translate(this.dir,-0.026,0);
         //scene.b3Dscene.stopAnimation(skeleton,0,30,true);
         if(this.intersectsMesh(target, true)){
           game.actions.move.active = false;
           target.position.x = 5000;
           scene.b3Dscene.stopAnimation(tSkeleton,0,100,true);
           scene.b3Dscene.stopAnimation(skeleton,0,100,true);
         }
       }.bind(player)
     });

    });


  }


  //TODO add this somehow to the game
  document.addEventListener( "DOMContentLoaded", start, false );

</script>
 </body>
</html>
