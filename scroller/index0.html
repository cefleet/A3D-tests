<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Space test</title>

    <script src="/libs/babylon.2.1-beta.debug.js"></script>
    <script src="/A3D/source/A3D.js"></script>
    <script src="/A3D/source/classes/Game.js"></script>
    <script src="/A3D/source/classes/Actor.js"></script>
    <script src="/A3D/source/classes/Actor.Player.js"></script>
    <script src="/A3D/source/classes/Scene.js"></script>
    <script src="/A3D/source/classes/Camera.js"></script>
    <script src="/A3D/source/classes/Controls.js"></script>
    <script src="/A3D/source/classes/Input.js"></script>
    <script src="/A3D/source/classes/Resource.js"></script>
    <script src="/A3D/source/classes/Input.Keyboard.js"></script>
    <script src="/A3D/source/classes/Input.Mouse.js"></script>
    <script src="/A3D/source/classes/Overlay.js"></script>
    <script src="/A3D/source/classes/Object2D.js"></script>
    <script src="/A3D/source/classes/Object2D.Image.js"></script>
    <script src="/A3D/source/classes/Action.js"></script>
    <script src="/A3D/source/classes/Trigger.js"></script>
    <script src="/A3D/source/classes/Trigger.Object3D.js"></script>
    <script src="/A3D/source/classes/Trigger.Object3D.Collision.js"></script>


    <script src='/A3D-Modules/Scroller/Scroller.js'></script>
    <script src='/A3D-Modules/Scroller/Scroller.Player.js'></script>


    <style>
        html, body {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id='game'></div>
<script>
    var game,scene,o,i,loose,win;
    function start(){
    game = new A3D.Game.Scroller({
        containerId:'game',//Probably not needed
        playerName : 'Actor.Player',
        lives: 3,
        speed : 0.4,
        collisionNames : ['Icosphere','Cube']
    });

    game.setupScene('/scroller/scenes/','nick.babylon', function(game){

        for(s in game.activeScenes){
            //game.activeScenes[s].b3Dscene.debugLayer.show();
            scene = game.activeScenes[s];
        }

        /*
        This is just to test clicking.. Should be a control.
        */
     window.addEventListener("click", function (evt) {
       clickedOnUI = false;
       if(o.overlays.mainScreen && o.overlays.mainScreen.pointInsideClickArea({x:evt.clientX, y:evt.clientY})){
         console.log('The main screen was clicked on');
         o.deleteObject2D('mainScreen');
         o.render();
         game.run();
      } else {
         //if not go here
         var pick = scene.b3Dscene.pick(evt.clientX, evt.clientY);
      }
    });


      o = new A3D.Overlay({},game);

      var heartObj = {
        src : '/scroller/heart.png',
        dX:0,
        dY:10,
        dWidth:30,
        dHeight:30
      };

      for(var i = 0; i < game.player.resources.lives.value; i++){
        heartObj.dX += 30;
        var h = new A3D.Object2D.Image(heartObj);
        o.addObject2D(h);
      }


      /*This is a test to test out the triggers*/
      /*This needs to go into a Module */

      //create the action
      game.createAction({
        name : 'pause',
        id : 'pause',
        active : false,
        func : function(){
          console.log('I have run into the end');
          o.addObject2D(win);
          game.b3Dengine.stopRenderLoop();
          o.render();

        }
      });

      var te = scene.b3Dscene.getMeshByName('Trigger.End');
      //cxreate the trigger
      var t = new A3D.Trigger.Object3D.Collision();
      t.addb3Dmesh(te);
      //add the action to the trigger
      t.addActivateAction(game.actions.pause);

      //Checks the trigger each frame
      game.createAction({
        name : 'checkIfAtEnd',
        id : 'checkIfAtEnd',
        func : function(){
          t.checkCollision(game.player.b3Dactor);
        }
      });

      game.createAction({
        name : 'removeHeart',
        func : function(){
          if(this.player._lostLife){
            o.removeLastObject2D();
            this.player.b3Dactor.position.x -= 1;
            if(this.player.resources.lives.value <= 0){
              o.addObject2D(loose);
              this.b3Dengine.stopRenderLoop();
            }
            o.render();
          }
        }.bind(game)
      });

      var main = new A3D.Object2D.Image({
        src:'/scroller/turtle2.png',
        id : 'mainScreen',
        dWidth : o.canvas.width,
        dHeight: o.canvas.height,
        clickArea : {
          x:0,
          y:0,
          height:o.canvas.height,
          width:o.canvas.width
        }
      });
      o.addObject2D(main);

      loose = new A3D.Object2D.Image({
        src : '/scroller/loose.png',
        id : 'loose',
        dWidth : o.canvas.width,
        dHeight: o.canvas.height,
        clickArea : {
          x:0,
          y:0,
          height:o.canvas.height,
          width:o.canvas.width
        }
      });

      win = new A3D.Object2D.Image({
        src : '/scroller/win.png',
        id : 'win',
        dWidth : o.canvas.width,
        dHeight: o.canvas.height,
        clickArea : {
          x:0,
          y:0,
          height:o.canvas.height,
          width:o.canvas.width
        }
      });
      o.render();

  //  game.run();//TODO this may be paused
    });
  }

  //TODO add this somehow to the game
  document.addEventListener( "DOMContentLoaded", start, false );

</script>
 </body>
</html>
