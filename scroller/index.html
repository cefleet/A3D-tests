<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Space test</title>

    <script src="/libs/babylon.2.1-beta.debug.js"></script>
    <script src="/A3D/source/A3D.js"></script>
    <script src="/A3D/source/classes/Game.js"></script>
    <script src="/A3D/source/classes/Actor.js"></script>
    <script src="/A3D/source/classes/Actor.Player.js"></script>
    <script src="/A3D/source/classes/Scene.js"></script>
    <script src="/A3D/source/classes/Camera.js"></script>
    <script src="/A3D/source/classes/Controls.js"></script>
    <script src="/A3D/source/classes/Input.js"></script>
    <script src="/A3D/source/classes/Resource.js"></script>
    <script src="/A3D/source/classes/Input.Keyboard.js"></script>
    <script src="/A3D/source/classes/Overlay.js"></script>
    <script src="/A3D/source/classes/Object2D.js"></script>
    <script src="/A3D/source/classes/Object2D.Image.js"></script>

    <script src='/A3D-Modules/Scroller/Scroller.js'></script>
    <script src='/A3D-Modules/Scroller/Scroller.Player.js'></script>


    <style>
        html, body {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }

        #game {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id='game'></div>
<script>
    var game,scene,o,i;
    function start(){
    game = new A3D.Game.Scroller({
        containerId:'game',//Probably not needed
        playerName : 'Actor.Player',
        collisionNames : ['Icosphere','Cube']
    });
    o = new A3D.Overlay({},game);
    i = new A3D.Object2D.Image({
      src : '/scroller/dog1.png'
    });
    o.addObject2D(i);
    game.setupScene('/scroller/scenes/','nick.babylon', function(game){

        for(s in game.activeScenes){
            game.activeScenes[s].b3Dscene.debugLayer.show();
            scene = game.activeScenes[s];
        }

        game.addRunFunction({
            name : 'testCollisions',
            func : function(){
               for(e in scene.actors){
                   if(!(scene.actors[e] instanceof A3D.Game.Scroller.Player)){
                       if(game.player.b3Dactor.intersectsMesh(scene.actors[e].b3Dactor, true)){
                           if(!game.player.collidedTime || (Date.now() - game.player.collidedTime) > 500){
                               if(game.player.resources['lives'].subtract(1) > 0){
                                   game.player.b3Dactor.position.x -= 5;//TODO don't do this make a shake function instead
                                   game.player.collidedTime = Date.now();
                                   console.log('inside '+scene.actors[e].name+"'s Bounding block");
                                } else {
                                   console.log('You Loose');
                                   game.b3Dengine.stopRenderLoop();
                               }
                           }
                       }
                   }
               }
            }
        });


     window.addEventListener("click", function (evt) {
        var pick = scene.b3Dscene.pick(evt.clientX, evt.clientY);
        console.log(pick);
      });


    game.run();
    });
  }
  document.addEventListener( "DOMContentLoaded", start, false )

</script>
 </body>
</html>
